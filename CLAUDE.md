# CLAUDE.md - Project Standards

## Tech Stack
- **Language**: Python 3.11+
- **Framework**: FastAPI (modern async web framework)
- **Database**: SQLAlchemy ORM with SQLite for development (can be swapped for PostgreSQL)
- **Testing**: pytest with pytest-asyncio for async testing
- **Password Hashing**: passlib with bcrypt
- **JWT/Auth**: python-jose for JWT tokens
- **Logging**: Python's built-in logging module with structured logging
- **API Docs**: Swagger/OpenAPI (auto-generated by FastAPI)
- **Utilities**: pydantic for data validation

## Project Structure
```
.
├── CLAUDE.md                    # This file - coding standards
├── requirements.txt             # Python dependencies
├── app/
│   ├── __init__.py
│   ├── main.py                  # FastAPI app entry point
│   ├── config.py                # Configuration (DB, logging, env vars)
│   ├── database.py              # Database setup and session management
│   ├── models.py                # SQLAlchemy ORM models (User, etc.)
│   ├── schemas.py               # Pydantic request/response schemas
│   ├── auth/
│   │   ├── __init__.py
│   │   ├── routes.py            # Login/register endpoints
│   │   ├── dependencies.py      # Auth dependencies (get_current_user, etc.)
│   │   ├── utils.py             # Hash/JWT token generation
│   ├── middleware/
│   │   ├── __init__.py
│   │   ├── logging.py           # Centralized logging middleware
│   │   ├── exception.py         # Centralized exception handling
│   │   ├── circuit_breaker.py   # Circuit breaker for external calls
├── tests/
│   ├── __init__.py
│   ├── conftest.py              # Pytest fixtures
│   ├── test_auth.py             # Auth endpoint tests
│   ├── test_models.py           # Database model tests
├── artifacts/
│   ├── auth/
│   │   ├── analysis.md          # Task analysis document
│   │   ├── sequence_diagram.puml # PlantUML sequence diagram
│   │   ├── flow_diagram.puml    # PlantUML flow diagram
│   │   ├── schema.md            # Database schema design
```

## Coding Conventions
- **Naming**:
  - Variables/functions: `snake_case`
  - Classes: `PascalCase`
  - Constants: `UPPER_SNAKE_CASE`
- **Imports**: Group in order: stdlib, third-party, local. Alphabetically within groups.
- **Type Hints**: Use type hints for all function parameters and return values
- **Docstrings**: Use triple-quoted strings for functions and classes (Google style)
- **Max Line Length**: 100 characters
- **Async**: Use `async`/`await` consistently throughout (FastAPI requirement)

## Commands
- **Install dependencies**: `pip install -r requirements.txt`
- **Run app**: `python -m uvicorn app.main:app --reload`
- **Run tests**: `pytest` or `pytest -v` for verbose
- **Run tests with coverage**: `pytest --cov=app --cov-report=html`
- **Access API docs**: http://localhost:8000/docs (Swagger UI)
- **Access ReDoc**: http://localhost:8000/redoc

## Key Patterns
- **Dependency Injection**: Use FastAPI's `Depends()` for auth, DB sessions, etc.
- **Async Database**: Use `async_sessionmaker` for async database operations
- **Error Handling**: Raise `HTTPException` for API errors; catch in middleware for logging
- **Middleware**: Applied globally via `app.add_middleware()` or as dependencies
- **Circuit Breaker**: Wrap external calls in decorator for automatic failure handling
- **Logging**: Use `logging.getLogger(__name__)` in each module; configure in middleware
